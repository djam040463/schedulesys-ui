<p-panel header="Care Companies Management">
	<md-list>
		<div style="text-align: center;">
			<span  class="fa fa-hospital-o fa-5x" ></span>
		</div>
		<md-divider></md-divider>
		<div>
			<div class="data-table">
			<p-messages [(value)]="msgs"></p-messages>
			<p-dataTable [value]="careCompanies" [rows]="10" [paginator]="true" resizableColumns="true"  [rowsPerPageOptions]="[10,20]"
				selectionMode="single" [(selection)]="selectedCompany" [contextMenu]="cm" dataKey="name" [totalRecords]="tableItemsCount"
				[lazy]="true" (onLazyLoad)="loadDataLazy($event)" [loading]="tableDataLoading" [emptyMessage]="'No care companies found'">
			    <p-header>Care Companies</p-header>
			    <p-column field="name" header="Name"></p-column>
			    <p-column field="address" header="Address"></p-column>
			    <p-column field="phoneNumber" header="Phone Number">
			    	<ng-template let-col let-row="rowData" pTemplate="body">
            			<span>{{row[col.field] | phonenumber}}</span>
       				</ng-template>
			    </p-column>
			    <p-column field="fax" header="Fax">
			    	<ng-template let-col let-row="rowData" pTemplate="body">
            			<span>{{row[col.field] | phonenumber}}</span>
       				</ng-template>
			    </p-column>
			    <p-column field="careCompanyType.name" header="Type"></p-column>
			</p-dataTable>
		</div>
		</div>
		<md-divider></md-divider>
		<data-table-crud (new)="showDialog(false)" (edit)="showDialog(true)" (delete)="deleteCareCompany()" 
			[disabled]="selectedCompany === undefined" (back)="gotToHome()"></data-table-crud>
	</md-list>
	<p-dialog [(visible)]="dialogDisplayed" width="450">
		 <p-header [ngSwitch]="editing">
        	<span *ngSwitchCase="true"> Editing a Care Company</span>
        	<span *ngSwitchCase="false"> Adding a Care Company</span>
   		 </p-header>
   		 <div>
   		 	<form (ngSubmit)="create()" #companyForm="ngForm">
				<div>
					<div class="ui-message ui-messages-error ui-corner-all" *ngIf="validation.formErrors.name">
						<i class="fa fa-close"></i>
						{{validation.formErrors.name}}
					</div>
					<md-input-container class="input-full">
						<input #name mdInput id="name" name="name" placeholder="Name" [(ngModel)]="careCompany.name"
							company-name-in-use [input-value]="careCompany.name" [old-value]="editing ? selectedCompany.name : undefined" 
							(duplicates)="onDuplicates($event)" minlength="2" maxlength="50" required>
						<md-hint align="end">{{name.value.length}} / 50</md-hint>
					</md-input-container>
				</div>
				<div>
					<div class="ui-message ui-messages-error ui-corner-all" *ngIf="validation.formErrors.address">
						<i class="fa fa-close"></i>
						{{validation.formErrors.address}}
					</div>
					<md-input-container class="input-full">
						<input #address mdInput id="address" name="address"  placeholder="Address" [(ngModel)]="careCompany.address" maxlength="50" required>
						<md-hint align="end">{{address.value.length}} / 50</md-hint>
					</md-input-container>
				</div>
				<div>
					<div class="ui-message ui-messages-error ui-corner-all" *ngIf="validation.formErrors.phoneNumber">
						<i class="fa fa-close"></i>
						{{validation.formErrors.phoneNumber}}
					</div>
					<md-input-container class="input-full">
						<input #phoneNumber [textMask]="{mask: phoneNumberMask}"  mdInput id="phoneNumber" 
						name="phoneNumber" placeholder="Phone Number" [(ngModel)]="careCompany.phoneNumber" required>
					</md-input-container>
				</div>
				<div>
					<div class="ui-message ui-messages-error ui-corner-all" *ngIf="validation.formErrors.fax">
							<i class="fa fa-close"></i>
							{{validation.formErrors.fax}}
					</div>
					<md-input-container class="input-full">
						<input #fax [textMask]="{mask: phoneNumberMask}" mdInput id="fax" name="fax" placeholder="Fax" [(ngModel)]="careCompany.fax" required>
					</md-input-container>
				</div>
				<div>
					<div class="ui-message ui-messages-error ui-corner-all" *ngIf="validation.formErrors.careCompanyType">
						<i class="fa fa-close"></i>
						{{validation.formErrors.careCompanyType}}
					</div>
					<p-dropdown name="role" [options]="careCompanyTypes" [(ngModel)]="careCompany.careCompanyType.name" placeholder="Care Company Type"
						appendTo="body" [style]="{'width':'100%'}" required></p-dropdown>
				</div>
				<dialog-crud (cancel)="hideDialog()" 
					[disabled]="!companyForm.form.valid || (unmaskNumber(phoneNumber.value).length != 10) || (unmaskNumber(fax.value).length != 10)"></dialog-crud>
			</form>
   		 </div>
	</p-dialog>
	<p-confirmDialog header="Confirmation" icon="fa fa-question-circle" width="425"></p-confirmDialog>
	<p-contextMenu #cm [model]="contextMenuItems" appendTo="body"></p-contextMenu>
</p-panel>